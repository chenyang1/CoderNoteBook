# 数据库

## 目录

* [存储引擎](#存储引擎)
* [事务](#事务)
* [索引](#索引)
* [写高效的SQL语句](#写高效的SQL语句)

---

## 存储引擎

* MYISAM / INNODB 的区别

    1. MYSQL(5.1的版本之后)的默认存储引擎 INNODB

    2. innodb 支持粒度更小的锁，也就是行锁

    3. innodb 支持事务


* 聚簇索引和非聚簇索引

    MyISAM 是非聚簇索引，innodb是聚簇索引。 聚簇索引和非聚簇索引的一个根本的区别是，索引和真正的数据是否是存放在一起的。如果是在一起，就是聚簇索引，如果不在一起，就是非聚簇索引。

    如下图所示：
    ![tu](../pic/数据库_1.jpg)


## 事务

* 事务的特性

    ACID 是什么意思？

    ![tu](../pic/数据库_2ACID.png)

    其中，一致性表示的是 事务只有起始状态和结束状态可以被其他事务看见，比如说，事务是 给 A -100元，给B + 100 元。那么，不一致的情况就是只给A 减去了100元，没有给B 加上100元。

* 事务的隔离等级

    四个隔离等级

    1. 读未提交 (READ-UNCOMMITTED)

        事务可以读到其他事务修改过（但是未提交的数据）

    2. 读提交 (READ-COMMITTED)

        事务可以只能读到其他事务提交过后的事务

    3. 可重复读 (REPEATED-READ)

        在一个事务中，多次读取一个变量，它的数值是一样的。

        （事务A在开始的时候，查询了一次变量a=100。然后，事务b启动，修改了一次变量a=200，然后提交。然后，事务A还没有结束，然后，继续查询了一次变量a。这个变量是多少呢？  如果隔离等级是读提交，这个a是=200；如果隔离等级是可重复读，这个a=100。因为一个事务中，读到的变量是一样的。）

    4. 串行化 (SERIALIZABLE)

        最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。

    举个例子：

    * 如果事务的隔离等级是 ：读未提交
    那么，事务B将变量的值从1修改为2，事务A在v1的值=2。（事务A读到事务B修改但是未提交的东西。）

    * 如果事务的隔离等级是：读提交
    那么，事务B将变量的值从1修改为2，事务A在v1的值=1，V2=2。（事务A读到事务B修改但是未提交的东西。）

    * 如果事务的隔离等级是: 可重复读
    那么，事务A读到的v1=1，然后，事务b把1修改为2，然后提交。事务a在查询的时候，为了保证可重复读，那么一定要等于v2=1。（保证一个事务中读到的变量是一样的）

    * 如果事务的隔离等级是：串行化
    那么事务a查询的时候，加上读锁。事务b修改的时候，试图加写锁。然后被block。等待事务a结束，释放读锁，然后事务b继续执行。

    隔离等级试图解决下面的几个问题：

    1. 脏读

        （读未提交的情况下，会出现脏读）

        脏读指的是：一个事务执行语句a插入一条数据，且并没有提交，然后再执行另外一条语句b修改回去。另外一个是事务分别语句a和语句b执行之后查询两次，读到的数据是不一样的。
    
    2. 不可重复读

        （读提交的情况下，会出现不可重复读）

        一个事务插入一条数据，然后再commit。另外一个事务分别在commit之前读和commit之后读，得到的结果是不一样的。


    3. 幻读 

        （可重复读的情况下，会出现幻读的情况）
        
        在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。

* 常用数据库的隔离级别：


    MySQL的隔离级别是**可重复读（第三级别的等级）** mysql的级别要更高一点哎 ~


* 参考：

    [廖雪峰-事务](https://www.liaoxuefeng.com/wiki/001508284671805d39d23243d884b8b99f440bfae87b0f4000/0015091672511496641de7eeea04f67bf55ccf22e35e428000)


## 索引

- [数据库索引](./数据库-索引.md)

## MVCC

## MYSQL的日志

## 选择主键的几种方案

## explain
