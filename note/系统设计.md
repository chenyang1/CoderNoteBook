
# 系统设计

系统设计需要考虑的三点：

* 高性能

* 高可用

* 可扩展

-----

## 高性能

性能优化首先要有一个完善的监控体系来度量性能指标。

比如
* 机器层面的 cpu，内存，io，网络等指标；

* 应用层面的 请求的平均响应时间（处理时间）


性能优化的“八二原则”，
大概的意思就是，少量的热点逻辑 消耗的大量的性能。所以，性能优化的第一部就是定位到热点，然后结合业务去优化和取舍（时间换空间，空间换时间，限流，降级，平滑等）


大部分的接口的性能都遵守这种图：
![](../pic/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A11.png)

----

## 高可用

1. 如何量化高可用性，评价指标是什么？

    GOOGLE SRE 里面提及了很多指标，大概就是系统是几个9，比如99%，99.9%, 99.99% 等。

2. 设计系统的时候，需要在可靠性方面 注意什么？ （design for failure）

    在设计系统的时候，把发生故障作为一个重要的考虑点，预先考虑如何自动化地发现故障，发生故障之后要如何解决。

    当然，除了要有未雨绸缪外，我们还需要掌握一些具体的优化方法，比如 failover（故障转移）、超时控制以及降级和限流。

    * 故障转移

        一个节点挂了，可以切换到其他的节点，或者可以重新拉起，或者有重试机制等。

        最广泛的故障检测机制是“心跳”，一个很经典的问题，就是系统的超时时间要设为多少？

        很多时候都是拍脑门，随便定一个。

        GOOGLE SRE 里面也提到这个事，比较科学的办法是，可以看下这台机器（或者这个接口）正常情况下，一个请求的响应时间是多少，拉出来一个分布图，大于99%或者是超过个比例 作为参考。

    * 服务降级

        当机器进入一个危险状态，丢弃掉或者拒绝掉一些不重要的服务，保证核心功能正常。

    * 限流 （平滑队列）等

        请求进行限速来保护系统

------

### 可扩展性

我理解，可扩展性是希望可以通过平行扩展（加机器的方式，而不是提供单台机器性能的方式)去提高性能的性能。或者是提供系统的可用性。

不过，这个话题更多的是要结合业务的特性去考虑，比如是否是有状态服务或无状态服务。如果是无状态的服务，那问题就会好很多。

尝试从几个方面去思考，比如：

1. 从数据的层面

    分库分表，水平拆分，垂直拆分

2. 从应用的层面

    按照有无状态，业务的功能（类似微服务的思想），进程的重要性 等角度去拆分