# 分布式id生成

在很多场景中，都有需要生成唯一id的需求。这个问题抽象出来，就是在分布式的环境下，如果不重复的id。

常见的几种方案

方案一：

集中式的唯一id生成，类似于预约一个号码段，不同的业务向一个中心节点去申请号段。


方案二：
类似于雪花算法的id生成思路，将一个64位的bit段，分为不同的区间。（时间 + 机器id + 序号）类似于这样。保证在某一个时间下，可以生成的id都是唯一的。

这里有一个小的trick，（时间 + 机器id + 序号）这样组合还有一个额外的优点，保证的id是单调增长的。如果id是用在做数据库主键的，可以保证主键的写入是一直追加到索引的后面的。

这里有可能出现一个时钟回拨的问题：

时钟回拨指的是：
时间回拨问题是指系统在运行过程中，可能由于网络时间校准或者人工设置，导致系统时间主动或被动地跳回到过去的某个时间。

美团的一个分布式id的文章提供了一个解决办法，增加了一个时钟id的字段。当现在的时间小于等于上次申请的时间的时候，时钟id++。不过这个只能解决系统没有重启的情况。（如果遇到系统重启 + 时间回拨 那问题就这个方式就没有办法了）

链接：

https://tech.meituan.com/2017/04/21/mt-leaf.html

https://blog.hackerpie.com/posts/algorithms/snowflake/multiple-clocks-snowflake/